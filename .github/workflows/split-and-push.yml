name: Split & Push Repositories

on:
  push:
    branches: ["main"]

jobs:
  split-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout monorepo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive  # ðŸ”¥ Permite copiar .github y ocultos

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Empujar FRONTEND
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Push Frontend to separate repo
        uses: cpina/github-action-push-to-another-repository@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.SPLIT_PUSH_TOKEN }}
        with:
          source-directory: "clients/web-client"
          destination-github-username: "proyecto-nube"
          destination-repository-name: "PetTrack-Front"
          target-branch: "main"
          user-email: "actions@github.com"
          user-name: "github-actions"
          commit-message: "Auto-sync frontend from monorepo"
          create-target-branch-if-needed: true
          target-directory: "."  # ðŸ”¥ Copia .github correctamente

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Empujar BACKEND
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Push Backend to separate repo
        uses: cpina/github-action-push-to-another-repository@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.SPLIT_PUSH_TOKEN }}
        with:
          source-directory: "services"
          destination-github-username: "proyecto-nube"
          destination-repository-name: "PetTrack-Back"
          target-branch: "main"
          user-email: "actions@github.com"
          user-name: "github-actions"
          commit-message: "Auto-sync backend from monorepo"
          create-target-branch-if-needed: true
          target-directory: "."  # ðŸ”¥ Copia .github correctamente
